{% extends 'base.html' %}
{% block content %}
<div class="container">
  <h2>Add Family</h2>
  
  <div class="alert alert-info mb-4" role="alert">
    <strong>ℹ️ Data Entry Tip:</strong> Enter the family name(s) in the "Adults" section. You can leave phone numbers blank if not available.
  </div>

  <form method="post">
    <!-- Authorized Adults - this is for emergency contacts/permission -->
    <div class="card mb-4">
      <div class="card-header bg-light">
        <h5 class="mb-0">Authorization Settings</h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label class="form-label"><strong>Who is authorized to pick up?</strong></label>
          <textarea name="authorized_adults" class="form-control" rows="2" placeholder="e.g., Mom, Dad, Grandma Jane, Aunt Sarah" style="font-size: 0.9rem;"></textarea>
          <small class="form-text text-muted d-block mt-2">
            List the names of all adults who are allowed to pick up the child(ren). This helps staff at check-out verify the correct person is picking up.
          </small>
        </div>
      </div>
    </div>

    <!-- Adults in Household -->
    <div class="card mb-4">
      <div class="card-header bg-light">
        <h5 class="mb-0">Adults in Household</h5>
      </div>
      <div class="card-body">
        <p class="text-muted"><small>Enter the names and phone numbers of adults associated with this family. The first adult will be used as the default at check-in.</small></p>
        
        <div id="adults">
          <div class="mb-3 border rounded p-3 bg-light">
            <div class="mb-2">
              <div class="d-flex align-items-center">
                <input type="radio" name="default_adult_index" value="0" class="form-check-input me-2" checked title="Set as default for check-in" />
                <div style="flex: 1;">
                  <input name="adults" class="form-control" placeholder="Name (e.g., John Smith)" required />
                </div>
              </div>
            </div>
            <input name="adult_phones" class="form-control" type="tel" placeholder="Phone number (optional, e.g., 555-123-4567)" style="font-size: 0.9rem;" />
            <small class="form-text text-muted d-block mt-2">The name and phone are used for check-in and family lookup.</small>
          </div>
        </div>
        
        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addField('adults')">+ Add Another Adult</button>
        <small class="form-text text-muted d-block mt-2">The adult with the radio button selected will be the default choice at check-in.</small>
      </div>
    </div>

    <!-- Children in Family -->
    <div class="card mb-4">
      <div class="card-header bg-light">
        <h5 class="mb-0">Children in Family</h5>
      </div>
      <div class="card-body">
        <p class="text-muted"><small>Enter each child's name and any important notes (allergies, special needs, etc.)</small></p>
        
        <div id="kids">
          <div class="mb-3 border rounded p-3 bg-light">
            <input name="kids" class="form-control mb-2" placeholder="Child's name (e.g., Sarah Smith)" required />
            <textarea name="kid_notes" class="form-control" rows="2" placeholder="Notes (e.g., peanut allergy, uses EpiPen, has hearing aid)" style="font-size: 0.9rem;"></textarea>
            <small class="form-text text-muted d-block mt-2">Notes are visible during check-in to alert staff of any special considerations.</small>
          </div>
        </div>
        
        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addField('kids')">+ Add Another Child</button>
      </div>
    </div>

    <!-- Hidden field for backwards compatibility -->
    <input type="hidden" name="troop" value="" />

    <!-- Submit -->
    <div class="mb-4">
      <button type="submit" class="btn btn-primary btn-lg">Add Family</button>
      <a href="/admin/families" class="btn btn-secondary btn-lg">Cancel</a>
    </div>
  </form>
</div>

<script>
function addField(type) {
  const div = document.getElementById(type);
  if (type === 'adults') {
    const currentCount = div.querySelectorAll('input[name="adults"]').length;
    const container = document.createElement('div');
    container.className = 'mb-3 border rounded p-3 bg-light';
    const wrapper = document.createElement('div');
    wrapper.className = 'mb-2';
    const radioWrapper = document.createElement('div');
    radioWrapper.className = 'd-flex align-items-center';
    const radio = document.createElement('input');
    radio.type = 'radio';
    radio.name = 'default_adult_index';
    radio.value = currentCount.toString();
    radio.className = 'form-check-input me-2';
    radio.title = 'Set as default for check-in';
    const inputWrapper = document.createElement('div');
    inputWrapper.style.flex = '1';
    const input = document.createElement('input');
    input.name = type;
    input.className = 'form-control';
    input.placeholder = 'Name (e.g., John Smith)';
    inputWrapper.appendChild(input);
    radioWrapper.appendChild(radio);
    radioWrapper.appendChild(inputWrapper);
    wrapper.appendChild(radioWrapper);
    const phoneInput = document.createElement('input');
    phoneInput.name = 'adult_phones';
    phoneInput.className = 'form-control';
    phoneInput.type = 'tel';
    phoneInput.placeholder = 'Phone number (optional, e.g., 555-123-4567)';
    phoneInput.style.fontSize = '0.9rem';
    const note = document.createElement('small');
    note.className = 'form-text text-muted d-block mt-2';
    note.textContent = 'The name and phone are used for check-in and family lookup.';
    container.appendChild(wrapper);
    container.appendChild(phoneInput);
    container.appendChild(note);
    div.appendChild(container);
  } else {
    const wrapper = document.createElement('div');
    wrapper.className = 'mb-3 border rounded p-3 bg-light';
    const input = document.createElement('input');
    input.name = type;
    input.className = 'form-control mb-2';
    input.placeholder = 'Child\'s name (e.g., Sarah Smith)';
    const textarea = document.createElement('textarea');
    textarea.name = 'kid_notes';
    textarea.className = 'form-control';
    textarea.rows = 2;
    textarea.placeholder = 'Notes (e.g., peanut allergy, uses EpiPen, has hearing aid)';
    textarea.style.fontSize = '0.9rem';
    const note = document.createElement('small');
    note.className = 'form-text text-muted d-block mt-2';
    note.textContent = 'Notes are visible during check-in to alert staff of any special considerations.';
    wrapper.appendChild(input);
    wrapper.appendChild(textarea);
    wrapper.appendChild(note);
    div.appendChild(wrapper);
  }
}
</script>
{% endblock %}