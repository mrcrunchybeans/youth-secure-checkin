{% extends 'base.html' %}
{% block content %}
<div class="container">
  <h2>Edit Family</h2>
  <form method="post">
    <div class="mb-3">
      <label class="form-label">{{ branding.group_term }}</label>
      <input name="troop" class="form-control" value="{{ family.troop or '' }}" />
    </div>
    <div class="mb-3">
      <label class="form-label">Authorized Adults for Checkout (applies to all kids)</label>
      <textarea name="authorized_adults" class="form-control" rows="2" placeholder="e.g., Mom, Dad, Grandma Jane" style="font-size: 0.9rem;">{{ family.authorized_adults or '' }}</textarea>
      <small class="form-text text-muted">List adults authorized to pick up any child in this family.</small>
    </div>
    <div class="mb-3">
      <label class="form-label">Adults</label>
      <div id="adults">
        {% for adult in adults %}
          <div class="mb-2">
            <input type="hidden" name="adult_ids" value="{{ adult.id }}" />
            <div class="d-flex align-items-center mb-1">
              <input type="radio" name="default_adult_id" value="{{ adult.id }}" class="me-2" {% if family.default_adult_id == adult.id %}checked{% endif %} title="Set as default for check-in" />
              <input name="adults" data-adult-id="{{ adult.id }}" class="form-control" value="{{ adult.name }}" placeholder="Adult name" />
            </div>
            <input name="adult_phones" class="form-control ms-4" type="tel" value="{{ adult.phone or '' }}" placeholder="Phone number (optional)" style="font-size: 0.9rem;" />
          </div>
        {% endfor %}
        <div class="mb-2">
          <input type="hidden" name="adult_ids" value="" />
          <div class="d-flex align-items-center mb-1">
            <input type="radio" name="default_adult_id" value="" class="me-2" title="Set as default for check-in" />
            <input name="adults" class="form-control" placeholder="Adult name" />
          </div>
          <input name="adult_phones" class="form-control ms-4" type="tel" placeholder="Phone number (optional)" style="font-size: 0.9rem;" />
        </div>
      </div>
      <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addField('adults')">Add Adult</button>
      <small class="form-text text-muted d-block mt-2">Select the radio button next to the adult who should be pre-selected during check-in. Each adult can have their own phone number for check-in.</small>
    </div>
    <div class="mb-3">
      <label class="form-label">Kids</label>
      <div id="kids">
        {% for kid in kids %}
          <div class="mb-3 border rounded p-2 bg-light">
            <input type="hidden" name="kid_ids" value="{{ kid.id }}" />
            <input name="kids" class="form-control mb-2" value="{{ kid.name }}" placeholder="Kid name" />
            <textarea name="kid_notes" class="form-control" rows="2" placeholder="Notes (dietary restrictions, special needs, etc.)" style="font-size: 0.9rem;">{{ kid.notes or '' }}</textarea>
          </div>
        {% endfor %}
        <div class="mb-3 border rounded p-2 bg-light">
          <input type="hidden" name="kid_ids" value="" />
          <input name="kids" class="form-control mb-2" placeholder="Kid name" />
          <textarea name="kid_notes" class="form-control" rows="2" placeholder="Notes (dietary restrictions, special needs, etc.)" style="font-size: 0.9rem;"></textarea>
        </div>
      </div>
      <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addField('kids')">Add Kid</button>
    </div>
    <button type="submit" class="btn btn-primary">Update Family</button>
  </form>
  <a href="/admin/families" class="btn btn-secondary mt-3">Back</a>
</div>
<script>
function addField(type) {
  const div = document.getElementById(type);
  if (type === 'adults') {
    const container = document.createElement('div');
    container.className = 'mb-2';
    const hiddenId = document.createElement('input');
    hiddenId.type = 'hidden';
    hiddenId.name = 'adult_ids';
    hiddenId.value = '';
    const wrapper = document.createElement('div');
    wrapper.className = 'd-flex align-items-center mb-1';
    const radio = document.createElement('input');
    radio.type = 'radio';
    radio.name = 'default_adult_id';
    radio.value = '';
    radio.className = 'me-2';
    radio.title = 'Set as default for check-in';
    const input = document.createElement('input');
    input.name = type;
    input.className = 'form-control';
    input.placeholder = 'Adult name';
    const phoneInput = document.createElement('input');
    phoneInput.name = 'adult_phones';
    phoneInput.className = 'form-control ms-4';
    phoneInput.type = 'tel';
    phoneInput.placeholder = 'Phone number (optional)';
    phoneInput.style.fontSize = '0.9rem';
    container.appendChild(hiddenId);
    wrapper.appendChild(radio);
    wrapper.appendChild(input);
    container.appendChild(wrapper);
    container.appendChild(phoneInput);
    div.appendChild(container);
  } else {
    const wrapper = document.createElement('div');
    wrapper.className = 'mb-3 border rounded p-2 bg-light';
    const hiddenId = document.createElement('input');
    hiddenId.type = 'hidden';
    hiddenId.name = 'kid_ids';
    hiddenId.value = '';
    const input = document.createElement('input');
    input.name = type;
    input.className = 'form-control mb-2';
    input.placeholder = 'Kid name';
    const textarea = document.createElement('textarea');
    textarea.name = 'kid_notes';
    textarea.className = 'form-control';
    textarea.rows = 2;
    textarea.placeholder = 'Notes (dietary restrictions, special needs, etc.)';
    textarea.style.fontSize = '0.9rem';
    wrapper.appendChild(hiddenId);
    wrapper.appendChild(input);
    wrapper.appendChild(textarea);
    div.appendChild(wrapper);
  }
}
</script>
{% endblock %}