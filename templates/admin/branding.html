{% extends 'base.html' %}
{% block content %}
<style>
  @media (max-width: 768px) {
    .d-flex.justify-content-between {
      flex-direction: column;
      align-items: flex-start !important;
    }
    .d-flex.justify-content-between > div {
      margin-top: 0.5rem;
    }
    h2 {
      font-size: 1.5rem;
    }
    .form-control-color {
      width: 50px !important;
      height: 35px !important;
    }
    .col-md-4, .col-md-8, .col-md-9, .col-md-3 {
      margin-bottom: 0.75rem;
    }
  }
</style>
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Branding Settings</h2>
    <div>
      <a href="/admin" class="btn btn-outline-secondary">← Admin Panel</a>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8">
      
      <!-- Organization Details -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">
            <i class="bi bi-building"></i> Organization Details
          </h5>
          <form method="POST">
            <h6 class="mb-3 pb-2 border-bottom small fw-bold text-muted">Organization</h6>
            <div class="row g-3">
              <div class="col-md-8">
                <label for="organization_name" class="form-label small fw-semibold mb-1">Organization Name</label>
                <input type="text" class="form-control form-control-sm" id="organization_name" name="organization_name" 
                       value="{{ branding.organization_name }}" placeholder="e.g., First Baptist Church">
              </div>
              <div class="col-md-4">
                <label for="organization_type" class="form-label small fw-semibold mb-1">Type</label>
                <select class="form-select form-select-sm" id="organization_type" name="organization_type">
                  <option value="church" {% if branding.organization_type == 'church' %}selected{% endif %}>Church</option>
                  <option value="youth_group" {% if branding.organization_type == 'youth_group' %}selected{% endif %}>Youth Group</option>
                  <option value="troop" {% if branding.organization_type == 'troop' %}selected{% endif %}>Troop</option>
                  <option value="sports_team" {% if branding.organization_type == 'sports_team' %}selected{% endif %}>Sports Team</option>
                  <option value="school" {% if branding.organization_type == 'school' %}selected{% endif %}>School</option>
                  <option value="daycare" {% if branding.organization_type == 'daycare' %}selected{% endif %}>Daycare</option>
                  <option value="other" {% if branding.organization_type == 'other' %}selected{% endif %}>Other</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="group_term" class="form-label small fw-semibold mb-1">Group Term</label>
                <input type="text" class="form-control form-control-sm" id="group_term" name="group_term" 
                       value="{{ branding.group_term }}" placeholder="e.g., Troop, Class, Team">
                <div class="text-muted" style="font-size: 0.7rem;">What you call groups</div>
              </div>
              <div class="col-md-4">
                <label for="event_date_range_months" class="form-label small fw-semibold mb-1">Event Date Range</label>
                <select class="form-select form-select-sm" id="event_date_range_months" name="event_date_range_months">
                  <option value="1" {% if event_date_range_months == 1 %}selected{% endif %}>±1 month</option>
                  <option value="2" {% if event_date_range_months == 2 %}selected{% endif %}>±2 months</option>
                  <option value="3" {% if event_date_range_months == 3 %}selected{% endif %}>±3 months</option>
                  <option value="6" {% if event_date_range_months == 6 %}selected{% endif %}>±6 months</option>
                  <option value="12" {% if event_date_range_months == 12 %}selected{% endif %}>±1 year</option>
                </select>
                <div class="text-muted" style="font-size: 0.7rem;">Events to show in dropdown</div>
              </div>
            </div>
            <h6 class="mt-4 mb-3 pb-2 border-bottom small fw-bold text-muted">Brand Colors</h6>
            <div class="row g-3">
              <div class="col-md-4">
                <label for="primary_color" class="form-label small fw-semibold mb-1">Primary Color</label>
                <div class="d-flex gap-2">
                  <input type="color" class="form-control form-control-color flex-shrink-0" 
                         id="primary_color" name="primary_color" value="{{ branding.primary_color }}" 
                         style="width: 60px; height: 38px;">
                  <input type="text" class="form-control form-control-sm color-hex-input" 
                         id="primary_color_hex" value="{{ branding.primary_color }}" 
                         style="font-family: monospace; font-size: 0.85rem;" 
                         placeholder="#000000" maxlength="7">
                </div>
              </div>
              <div class="col-md-4">
                <label for="secondary_color" class="form-label small fw-semibold mb-1">Secondary Color</label>
                <div class="d-flex gap-2">
                  <input type="color" class="form-control form-control-color flex-shrink-0" 
                         id="secondary_color" name="secondary_color" value="{{ branding.secondary_color }}" 
                         style="width: 60px; height: 38px;">
                  <input type="text" class="form-control form-control-sm color-hex-input" 
                         id="secondary_color_hex" value="{{ branding.secondary_color }}" 
                         style="font-family: monospace; font-size: 0.85rem;" 
                         placeholder="#000000" maxlength="7">
                </div>
              </div>
              <div class="col-md-4">
                <label for="accent_color" class="form-label small fw-semibold mb-1">Accent Color</label>
                <div class="d-flex gap-2">
                  <input type="color" class="form-control form-control-color flex-shrink-0" 
                         id="accent_color" name="accent_color" value="{{ branding.accent_color }}" 
                         style="width: 60px; height: 38px;">
                  <input type="text" class="form-control form-control-sm color-hex-input" 
                         id="accent_color_hex" value="{{ branding.accent_color }}" 
                         style="font-family: monospace; font-size: 0.85rem;" 
                         placeholder="#000000" maxlength="7">
                </div>
              </div>
            </div>
            <div class="mt-3">
              <button type="button" class="btn btn-sm" id="preview-btn"
                      style="background: {{ branding.primary_color }}; color: white; border: none; font-family: inherit;">
                <i class="bi bi-eye"></i> Color Preview
              </button>
            </div>
            <div class="mt-3">
              <button type="submit" name="action" value="update_branding" class="btn btn-primary">
                <i class="bi bi-check-lg"></i> Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Logo Upload -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">
            <i class="bi bi-image"></i> Logo
          </h5>
          <form method="POST" enctype="multipart/form-data">
            <div class="row g-3">
              {% if current_logo %}
              <div class="col-md-4">
                <label class="form-label small fw-semibold mb-1">Current Logo</label>
                <div class="border rounded p-2 text-center bg-light">
                  <img src="{{ url_for('static', filename='uploads/' + current_logo) }}" alt="Logo" style="max-height: 80px; max-width: 100%;">
                </div>
              </div>
              <div class="col-md-8">
              {% else %}
              <div class="col-12">
              {% endif %}
                <label for="logo_file" class="form-label small fw-semibold mb-1">
                  {% if current_logo %}Replace Logo{% else %}Upload Logo{% endif %}
                </label>
                <input type="file" class="form-control form-control-sm" id="logo_file" name="logo_file" accept="image/png,image/jpeg,image/jpg,image/svg+xml">
                <div class="text-muted small mt-1">PNG, JPG, or SVG • Max 200px height</div>
                <div class="mt-2">
                  <button type="submit" name="action" value="upload_logo" class="btn btn-sm" style="background: {{ branding.secondary_color }}; color: white;">
                    <i class="bi bi-{% if current_logo %}arrow-repeat{% else %}upload{% endif %}"></i> {% if current_logo %}Replace{% else %}Upload{% endif %}
                  </button>
                  {% if current_logo %}
                  <button type="submit" name="action" value="remove_logo" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remove logo?');">
                    <i class="bi bi-trash"></i> Remove
                  </button>
                  {% endif %}
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Favicon Upload -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">
            <i class="bi bi-browser-chrome"></i> Favicon
          </h5>
          <form method="POST" enctype="multipart/form-data">
            <div class="row g-3">
              {% if current_favicon %}
              <div class="col-md-4">
                <label class="form-label small fw-semibold mb-1">Current Favicon</label>
                <div class="border rounded p-2 text-center bg-light">
                  <img src="{{ url_for('static', filename='uploads/' + current_favicon) }}" alt="Favicon" style="max-height: 32px; max-width: 32px;">
                </div>
              </div>
              <div class="col-md-8">
              {% else %}
              <div class="col-12">
              {% endif %}
                <label for="favicon_file" class="form-label small fw-semibold mb-1">
                  {% if current_favicon %}Replace Favicon{% else %}Upload Favicon{% endif %}
                </label>
                <input type="file" class="form-control form-control-sm" id="favicon_file" name="favicon_file" accept="image/x-icon,image/png,image/jpeg,image/jpg">
                <div class="text-muted small mt-1">ICO, PNG, or JPG • Recommended 32x32 pixels</div>
                <div class="mt-2">
                  <button type="submit" name="action" value="upload_favicon" class="btn btn-sm" style="background: {{ branding.secondary_color }}; color: white;">
                    <i class="bi bi-{% if current_favicon %}arrow-repeat{% else %}upload{% endif %}"></i> {% if current_favicon %}Replace{% else %}Upload{% endif %}
                  </button>
                  {% if current_favicon %}
                  <button type="submit" name="action" value="remove_favicon" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remove favicon?');">
                    <i class="bi bi-trash"></i> Remove
                  </button>
                  {% endif %}
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Footer Settings -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">
            <i class="bi bi-footer"></i> Footer Settings
          </h5>
          <form method="POST">
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="footer_enabled" name="footer_enabled" {% if footer_enabled %}checked{% endif %}>
                <label class="form-check-label" for="footer_enabled">Show Footer</label>
              </div>
              <div class="form-text">Display footer at the bottom of all pages</div>
            </div>
            <div class="mb-3">
              <label for="footer_text" class="form-label">Custom Footer Text</label>
              <input type="text" class="form-control" id="footer_text" name="footer_text" value="{{ footer_text }}" placeholder="Leave blank for default copyright text">
              <div class="form-text">Custom text to show instead of default copyright (e.g., "© 2025 My Organization - All Rights Reserved")</div>
            </div>
            <div class="mb-3">
              <label class="form-label">Show Elements</label>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="footer_show_github" name="footer_show_github" {% if footer_show_github %}checked{% endif %}>
                <label class="form-check-label" for="footer_show_github">
                  GitHub Link ("Powered by Youth Secure Check-in")
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="footer_show_version" name="footer_show_version" {% if footer_show_version %}checked{% endif %}>
                <label class="form-check-label" for="footer_show_version">
                  Version Number
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="footer_show_admin_link" name="footer_show_admin_link" {% if footer_show_admin_link %}checked{% endif %}>
                <label class="form-check-label" for="footer_show_admin_link">
                  Admin Link (when logged in)
                </label>
              </div>
            </div>
            <button type="submit" name="action" value="update_footer" class="btn btn-primary">
              <i class="bi bi-check-lg"></i> Update Footer
            </button>
          </form>
        </div>
      </div>

      <!-- Timezone Settings -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">
            <i class="bi bi-clock-history"></i> Time Zone
          </h5>
          <form method="POST">
            <div class="row g-3">
              <div class="col-md-9">
                <label for="timezone" class="form-label">System Time Zone</label>
                <select class="form-select" id="timezone" name="timezone">
                  <optgroup label="US Time Zones">
                    <option value="America/New_York" {% if current_timezone == 'America/New_York' %}selected{% endif %}>Eastern Time (ET)</option>
                    <option value="America/Chicago" {% if current_timezone == 'America/Chicago' %}selected{% endif %}>Central Time (CT)</option>
                    <option value="America/Denver" {% if current_timezone == 'America/Denver' %}selected{% endif %}>Mountain Time (MT)</option>
                    <option value="America/Phoenix" {% if current_timezone == 'America/Phoenix' %}selected{% endif %}>Arizona Time (no DST)</option>
                    <option value="America/Los_Angeles" {% if current_timezone == 'America/Los_Angeles' %}selected{% endif %}>Pacific Time (PT)</option>
                    <option value="America/Anchorage" {% if current_timezone == 'America/Anchorage' %}selected{% endif %}>Alaska Time (AKT)</option>
                    <option value="Pacific/Honolulu" {% if current_timezone == 'Pacific/Honolulu' %}selected{% endif %}>Hawaii Time (HST)</option>
                  </optgroup>
                  <optgroup label="Other Common Time Zones">
                    <option value="UTC" {% if current_timezone == 'UTC' %}selected{% endif %}>UTC (Coordinated Universal Time)</option>
                    <option value="Europe/London" {% if current_timezone == 'Europe/London' %}selected{% endif %}>London (GMT/BST)</option>
                    <option value="Europe/Paris" {% if current_timezone == 'Europe/Paris' %}selected{% endif %}>Paris (CET/CEST)</option>
                    <option value="Asia/Tokyo" {% if current_timezone == 'Asia/Tokyo' %}selected{% endif %}>Tokyo (JST)</option>
                    <option value="Australia/Sydney" {% if current_timezone == 'Australia/Sydney' %}selected{% endif %}>Sydney (AEDT/AEST)</option>
                  </optgroup>
                </select>
                <div class="form-text">Used for displaying times in check-in history and reports</div>
              </div>
              <div class="col-md-3 d-flex align-items-end">
                <button type="submit" name="action" value="update_timezone" class="btn btn-info w-100">
                  <i class="bi bi-clock"></i> Update
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

    </div>

    <!-- Help Panel -->
    <div class="col-lg-4">
      <div class="card mb-4 bg-light">
        <div class="card-body">
          <h6 class="card-title">
            <i class="bi bi-info-circle"></i> Branding Tips
          </h6>
          <ul class="small mb-0">
            <li class="mb-2">Choose colors that represent your organization's identity</li>
            <li class="mb-2">Primary color appears in headers and buttons</li>
            <li class="mb-2">Secondary color is used for accents</li>
            <li class="mb-2">Logos should be PNG or SVG for best quality</li>
            <li class="mb-2">Favicon appears in browser tabs (32x32px recommended)</li>
            <li class="mb-2">Timezone affects check-in timestamps and reports</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Sync color pickers with hex inputs (bidirectional)
  ['primary', 'secondary', 'accent'].forEach(colorType => {
    const picker = document.getElementById(colorType + '_color');
    const textInput = document.getElementById(colorType + '_color_hex');
    
    // Picker → Text input
    picker.addEventListener('input', function() {
      textInput.value = this.value.toUpperCase();
    });
    
    // Text input → Picker (on input for live update)
    textInput.addEventListener('input', function() {
      let val = this.value.trim();
      // Add # if missing
      if (val && !val.startsWith('#')) {
        val = '#' + val;
        this.value = val;
      }
      // Validate hex format and update picker
      if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
        picker.value = val.toLowerCase();
        this.classList.remove('is-invalid');
      } else if (val.length > 0) {
        this.classList.add('is-invalid');
      }
    });
    
    // On blur, normalize the value
    textInput.addEventListener('blur', function() {
      let val = this.value.trim().toUpperCase();
      if (val && !val.startsWith('#')) {
        val = '#' + val;
      }
      if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
        this.value = val;
        picker.value = val.toLowerCase();
        this.classList.remove('is-invalid');
      } else if (val) {
        // Reset to picker value if invalid
        this.value = picker.value.toUpperCase();
        this.classList.remove('is-invalid');
      }
    });
  });
</script>
{% endblock %}
