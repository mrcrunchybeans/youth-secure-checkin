{% extends "base.html" %}

{% block title %}Check-in Kiosk | {{ current_event_name }} - {{ current_event_date }}{% endblock %}

{% block head %}
<style>
/* iPad-Optimized Kiosk Layout */
/* CRITICAL: Keypad must be visible on all devices without scrolling */

/* Container layout based on viewport aspect ratio */
.kiosk-container {
    display: grid;
    gap: 1rem;
    padding: 0.5rem;
    max-width: 100%;
    /* Use dynamic viewport height if supported, fallback to vh */
    height: calc(100vh - 70px);
    height: calc(100dvh - 70px);
}

/* Landscape orientation: Side-by-side split */
@media (orientation: landscape) {
    .kiosk-container {
        grid-template-columns: minmax(350px, 45%) 1fr;
        grid-template-rows: 1fr;
        align-items: start;
        height: calc(100vh - 70px); /* Use available height */
        height: calc(100dvh - 70px);
        overflow: hidden;
    }
    
    .kiosk-left {
        height: 100%;
        overflow-y: auto;
        padding-right: 0.5rem;
    }
    
    .kiosk-right {
        height: 100%;
        overflow-y: auto;
        border-left: 1px solid #dee2e6;
        padding-left: 0.5rem;
    }
}

/* Portrait orientation: Stack vertically with fixed form and scrolling list */
@media (orientation: portrait) {
    .kiosk-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto minmax(0, 1fr); /* Form takes natural height, list takes rest */
        height: calc(100vh - 70px); /* Constrain to viewport */
        height: calc(100dvh - 70px);
        gap: 0.5rem;
        overflow: hidden;
    }
    
    .kiosk-left {
        /* Form section - should fit on screen */
        width: 100%;
        z-index: 10;
        background: var(--bg-color); /* Match background to cover list when scrolling? No, it's separate */
    }
    
    .kiosk-checkin-card {
        background: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 0;
    }
    
    .kiosk-right {
        /* Checked-in list below, scrollable */
        overflow-y: auto;
        border-top: 1px solid #dee2e6;
        padding-top: 0.5rem;
    }
}

/* Phone number input - compact but readable */
#phone {
    font-size: clamp(1.5rem, 3.5vw, 2.5rem);
    padding: 0.6rem 1rem;
    height: auto;
    text-align: center;
    letter-spacing: 0.4rem;
    font-weight: 700;
    max-width: 100%;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    transition: border-color 0.2s ease;
}

#phone:focus {
    border-color: {{ branding.primary_color }};
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

[data-theme="dark"] #phone {
    background-color: var(--input-bg);
    border-color: var(--input-border);
    color: var(--text-color);
}

/* Keypad - fluid sizing based on viewport */
#keypad {
    max-width: 100%;
    width: 100%;
}

.keypad-key {
    font-size: clamp(1.2rem, 3vw, 2rem);
    padding: 0.6rem;
    /* Flexible height for consistent layout */
    height: clamp(45px, 7vh, 70px);
    min-height: 45px;
    font-weight: 700;
    border: 2px solid #adb5bd;
    transition: all 0.15s ease;
    border-radius: 6px;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.1);
    color: #495057;
}

[data-theme="dark"] .keypad-key {
    background: var(--card-bg);
    border-color: var(--card-border);
    color: var(--text-color);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.1);
}

[data-theme="dark"] .keypad-key:hover {
    background: var(--card-border);
    border-color: var(--btn-primary);
}

[data-theme="dark"] .keypad-key:active {
    background-color: var(--btn-primary) !important;
    color: white !important;
    border-color: var(--btn-primary) !important;
}

[data-theme="dark"] #keypad-clear {
    background: var(--card-bg);
    border-color: var(--btn-secondary);
    color: var(--text-color);
}

[data-theme="dark"] #keypad-back {
    background: var(--card-bg);
    border-color: #dc3545;
    color: #dc3545;
}

.keypad-key:hover {
    background: #e9ecef;
    border-color: {{ branding.primary_color }};
    box-shadow: 0 4px 12px rgba(0,0,0,0.2), 0 2px 4px rgba(0,0,0,0.1);
    transform: translateY(-1px);
}

.keypad-key:active {
    transform: scale(0.95);
    background-color: {{ branding.primary_color }} !important;
    color: white !important;
    border-color: {{ branding.primary_color }} !important;
}

#keypad-clear, #keypad-back {
    font-size: clamp(0.9rem, 2vw, 1.3rem);
    padding: 0.6rem;
    height: 60px;
    min-height: 60px;
    font-weight: 600;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.1);
}

#keypad-clear {
    background: #f8f9fa;
    border: 2px solid #6c757d;
    color: #6c757d;
}

#keypad-back {
    background: #fff3cd;
    border: 2px solid #ffc107;
    color: #856404;
}

/* Check In button - compact but prominent */
#search-btn {
    font-size: clamp(1.1rem, 2.5vw, 1.6rem);
    padding: 0.8rem 1rem;
    height: 55px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.15);
    transition: all 0.2s ease;
    border-radius: 8px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

#search-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
}

#search-btn:active {
    transform: scale(0.98);
}

/* Cards - clean, modern styling */
.card {
    border: 2px solid #dee2e6;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-radius: 16px;
    overflow: visible;
}

.card-body {
    /* Compact padding to maximize space for keypad */
    padding: 1rem;
}

.card-title {
    color: {{ branding.primary_color }};
    font-weight: 700;
    font-size: clamp(1.2rem, 2.2vw, 1.6rem);
    margin-bottom: 0.8rem;
}

/* Form label */
.form-label {
    font-size: clamp(0.95rem, 1.8vw, 1.2rem);
    margin-bottom: 0.6rem;
    display: block;
    text-align: center;
    font-weight: 600;
    color: #495057;
}

/* Table styling for checked-in list */
.table-responsive {
    border-radius: 12px;
    border: 2px solid #dee2e6;
    max-height: calc(100vh - 150px);
}

.table {
    margin-bottom: 0;
    font-size: clamp(0.85rem, 1.5vw, 1.1rem);
}

.table thead th {
    background-color: var(--card-bg);
    font-weight: 700;
    border-bottom: 3px solid var(--card-border);
    position: sticky;
    top: 0;
    z-index: 10;
    color: {{ branding.primary_color }};
}

.table tbody tr {
    height: clamp(2.5rem, 5vh, 4rem);
}

.table tbody tr:hover {
    background-color: var(--card-border);
}

.checkout-btn {
    font-size: 0.9rem;
    padding: 0.4rem 0.8rem;
    font-weight: 600;
    border-radius: 6px;
    white-space: nowrap;
}

/* Header sizing */
h1 {
    font-size: clamp(1.5rem, 3.5vw, 2.5rem) !important;
    font-weight: 700;
}

.text-center.mb-3 {
    font-size: clamp(0.9rem, 1.8vw, 1.2rem);
}

/* Logo sizing */
.text-center.mb-3 img {
    max-height: clamp(60px, 12vh, 150px) !important;
    width: auto;
    object-fit: contain;
}

/* Mobile-specific adjustments (very small screens) */
@media (max-width: 480px) {
    .kiosk-container {
        padding: 0.25rem;
        gap: 0.5rem;
    }
    
    .card-body {
        padding: 0.75rem !important;
    }
    
    .card-title {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    
    #phone {
        font-size: 1.5rem;
        padding: 0.4rem;
        letter-spacing: 0.2rem;
    }
    
    .keypad-key, #keypad-clear, #keypad-back {
        height: 50px;
        min-height: 50px;
        font-size: 1.2rem;
        padding: 0;
    }
    
    #search-btn {
        height: 45px;
        font-size: 1rem;
        padding: 0.5rem;
    }
    
    h1 {
        font-size: 1.5rem !important;
    }
    
    .text-center.mb-3 {
        font-size: 0.8rem;
        margin-bottom: 0.5rem !important;
    }
}

/* Very large screens - constrain maximum sizes */
@media (min-width: 1920px) {
    .kiosk-container {
        max-width: 1600px;
        margin: 0 auto;
    }
    
    .keypad-key {
        max-height: 100px;
    }
    
    #phone {
        max-width: 500px;
        margin: 0 auto;
    }
}

/* Keypad styles for better visibility in both light and dark modes */
.keypad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin: 20px 0;
}

.keypad button {
    font-size: 1.5rem;
    padding: 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
}

/* Light mode styles */
body.light-mode .keypad button {
    background-color: #f0f0f0;
    color: #333;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

body.light-mode .keypad button:hover {
    background-color: #e0e0e0;
}

/* Dark mode styles */
body.dark-mode .keypad button {
    background-color: #333;
    color: #fff;
    box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
}

body.dark-mode .keypad button:hover {
    background-color: #444;
}
</style>
{% endblock %}

{% block navbar_buttons %}
<button id="fullscreen-btn-nav" class="btn btn-outline-light btn-sm me-2">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrows-fullscreen" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z"/>
    </svg>
</button>
<div class="d-inline-block">
    <!-- Desktop/tablet: Bootstrap dropdown -->
    <div class="dropdown d-none d-sm-inline-block">
        <button class="btn btn-outline-light btn-sm dropdown-toggle me-2" type="button" id="eventDropdownNav" data-bs-toggle="dropdown" aria-expanded="false" title="{{ current_event_name }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-calendar-event" viewBox="0 0 16 16">
                <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"/>
                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
            </svg>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="eventDropdownNav">
            {% for event in events %}
            <li><a class="dropdown-item" href="{{ url_for('kiosk', event_id=event.id) }}">{{ event.name }} - {{ event.formatted_start }}</a></li>
            {% endfor %}
        </ul>
    </div>
    <!-- Mobile: open a modal with events (prevents dropdown cutoff) -->
    <button class="btn btn-outline-light btn-sm d-inline d-sm-none me-2" type="button" id="eventModalBtn" data-bs-toggle="modal" data-bs-target="#eventModal" title="{{ current_event_name }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-calendar-event" viewBox="0 0 16 16">
            <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"/>
            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
        </svg>
    </button>
</div>
<a class="btn btn-link text-white text-decoration-none" href="/history" title="History">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
        <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"/>
        <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"/>
        <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"/>
    </svg>
</a>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% if logo_filename %}
    <div class="text-center mb-3">
        <img src="{{ url_for('static', filename='uploads/' + logo_filename) }}" alt="Logo" style="max-height: 150px; max-width: 100%;">
    </div>
    {% endif %}
    
    <h1 class="text-center mb-1" style="font-size: 2rem;">Check-in Kiosk</h1>
    <p class="text-center mb-3" style="font-size: 1rem; color: #666; font-weight: normal;">{{ current_event_name }} - {{ current_event_date }}</p>

    <!-- Responsive kiosk container: stacks on portrait, splits on landscape -->
    <div class="kiosk-container">
        <!-- Left column: Check-in Form -->
        <div class="kiosk-left">
            <div class="card kiosk-checkin-card" style="margin-bottom: 0.5rem;">
                <div class="card-body">
                    <h3 class="card-title">Family Lookup</h3>
                    <form id="checkin-form">
                        <input type="hidden" id="event-id" value="{{ current_event_id }}">
                        <div style="margin-bottom: 0.5rem;">
                            <label for="phone" class="form-label">Last 4 digits:</label>
                            <input type="tel" inputmode="numeric" class="form-control" id="phone" name="phone" maxlength="4" pattern="\d{4}" required aria-label="Last four digits" autocomplete="off">
                        </div>

                        <!-- On-screen numeric keypad for touch screens -->
                        <div id="keypad" style="margin-bottom: 0.5rem;">
                            <div class="keypad">
                                <button type="button" class="btn keypad-key" data-value="1">1</button>
                                <button type="button" class="btn keypad-key" data-value="2">2</button>
                                <button type="button" class="btn keypad-key" data-value="3">3</button>
                                <button type="button" class="btn keypad-key" data-value="4">4</button>
                                <button type="button" class="btn keypad-key" data-value="5">5</button>
                                <button type="button" class="btn keypad-key" data-value="6">6</button>
                                <button type="button" class="btn keypad-key" data-value="7">7</button>
                                <button type="button" class="btn keypad-key" data-value="8">8</button>
                                <button type="button" class="btn keypad-key" data-value="9">9</button>
                                <button type="button" id="keypad-clear" class="btn">Clear</button>
                                <button type="button" class="btn keypad-key" data-value="0">0</button>
                                <button type="button" id="keypad-back" class="btn">‚å´</button>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-lg w-100" id="search-btn" style="background-color: {{ branding.primary_color }}; color: white; border: none;">Check In</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right column: Currently Checked In -->
        <div class="kiosk-right">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Currently Checked In</h3>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Kid Name</th>
                                    <th>Phone</th>
                                    <th>Adult</th>
                                    <th>Time</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="checked-in-list">
                                {% for checkin in checked_in %}
                                <tr>
                                    <td style="vertical-align: middle;">
                                        {{ checkin.kid_name }}
                                        {% if checkin.kid_notes %}
                                          <span class="text-muted ms-1" style="cursor: pointer; font-size: 0.75rem; opacity: 0.6;" 
                                                data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true"
                                                title="{{ checkin.kid_notes | replace('\n', '<br>') }}">‚ÑπÔ∏è</span>
                                        {% endif %}
                                        {% if checkin.authorized_adults %}
                                          <span class="text-muted ms-1" style="cursor: pointer; font-size: 0.75rem; opacity: 0.6;" 
                                                data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true"
                                                title="<strong>Authorized for Checkout:</strong><br>{{ checkin.authorized_adults | replace('\n', '<br>') }}">üë§</span>
                                        {% endif %}
                                    </td>
                                    <td style="vertical-align: middle;">{{ checkin.phone }}</td>
                                    <td style="vertical-align: middle;">{{ checkin.adult_name }}</td>
                                    <td style="vertical-align: middle;">{{ checkin.formatted_time }}</td>
                                    <td style="vertical-align: middle;">
                                        <button class="btn btn-warning checkout-btn"
                                                data-kid-id="{{ checkin.kid_id }}"
                                                data-kid-name="{{ checkin.kid_name }}"
                                                data-event-id="{{ current_event_id }}">Check-Out</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                    <!-- Mobile event selector modal (prevents dropdown cutoff) -->
                    <div class="modal fade" id="eventModal" tabindex="-1">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header" style="background-color: {{ branding.primary_color }}; color: white;">
                                    <h5 class="modal-title">Select Event</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body" style="max-height:60vh; overflow-y:auto;">
                                    <div class="list-group">
                                        {% for event in events %}
                                        <a href="{{ url_for('kiosk', event_id=event.id) }}" class="list-group-item list-group-item-action">{{ event.formatted_start }} ‚Äî {{ event.name }}</a>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal for Family Selection -->
<div class="modal fade" id="familyModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="padding: 1.5rem; background-color: {{ branding.primary_color }}; color: white;">
                <h5 class="modal-title" style="font-size: 1.8rem;">Select Family Members</h5>
                <button type="button" class="btn-close btn-close-white" style="font-size: 1.5rem;" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modal-body" style="padding: 1.5rem; font-size: 1.2rem; max-height: 60vh; overflow-y: auto;">
                <!-- Family data will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- QR Code Modal -->
<div class="modal fade" id="qrCodeModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 420px;">
    <div class="modal-content" style="border-radius: 15px; overflow: hidden; border: 3px solid {{ branding.primary_color }};">
      <div class="modal-header" style="background: linear-gradient(135deg, {{ branding.primary_color }} 0%, {{ branding.secondary_color }} 100%); color: white; border: none; padding: 1rem;">
        <h5 class="modal-title" style="font-size: 1.3rem; font-weight: 700;">üì± Scan for Checkout Code</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center" style="padding: 1.5rem;">
        <img id="qr-code-img" src="" alt="QR Code" style="max-width: 250px; width: 100%; border: 5px solid #f8f9fa; border-radius: 10px;">
        <div class="mt-3 mb-2" style="background: #f8f9fa; border: 2px solid {{ branding.primary_color }}; border-radius: 10px; padding: 0.8rem;">
          <div class="text-muted mb-1" style="font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05rem;">Checkout Code</div>
          <div id="qr-code-text" style="font-size: 1.8rem; font-weight: bold; color: {{ branding.primary_color }}; font-family: 'Courier New', monospace; letter-spacing: 0.3rem;"></div>
        </div>
        <div id="short-url-container-kiosk" style="display: none; margin-top: 1rem;">
          <p class="text-muted mb-1" style="font-size: 0.75rem;">Or visit:</p>
          <a id="short-url-link-kiosk" href="" target="_blank" style="font-size: 1.1rem; font-weight: 600; color: {{ branding.primary_color }}; text-decoration: none; word-break: break-all;"></a>
        </div>
        <p class="text-muted mb-0 mt-2" style="font-size: 0.85rem; line-height: 1.4;">Scan QR code, visit the link, or write down the code above</p>
      </div>
      <div class="modal-footer" style="border: none; justify-content: center; padding: 1rem 1.5rem;">
        <button type="button" class="btn" style="background: linear-gradient(135deg, {{ branding.primary_color }} 0%, {{ branding.secondary_color }} 100%); color: white; border: none; border-radius: 10px; padding: 0.6rem 2rem; font-size: 1.1rem; font-weight: 600;" data-bs-dismiss="modal">Done</button>
      </div>
    </div>
  </div>
</div>

<!-- Checkout Code Entry Modal -->
<div class="modal fade" id="checkoutCodeModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 380px;">
    <div class="modal-content" style="border-radius: 15px; overflow: hidden; border: 3px solid {{ branding.primary_color }};">
      <div class="modal-header" style="background: linear-gradient(135deg, {{ branding.primary_color }} 0%, {{ branding.secondary_color }} 100%); color: white; border: none; padding: 0.6rem 0.9rem;">
        <h5 class="modal-title" style="font-size: 1.15rem; font-weight: 700;">üîí Enter Code</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="padding: 0.8rem;">
        <p class="text-center mb-2" style="font-size: 0.9rem; font-weight: 600; color: #333;" id="checkout-kid-name"></p>
        <form id="checkout-code-form">
          <div class="mb-2">
            <input type="text" class="form-control text-center" id="checkout-code-input" 
                   style="font-size: 1.4rem; letter-spacing: 0.3rem; font-family: 'Courier New', monospace; border: 2px solid {{ branding.primary_color }}; font-weight: bold; padding: 0.35rem;"
                   maxlength="10" required autocomplete="off" inputmode="none" placeholder="Code">
          </div>
          
          <!-- On-screen keypad -->
          <div id="checkout-keypad" class="mb-2">
            <div class="d-grid" style="grid-template-columns: repeat(3, 1fr); gap: 0.35rem; display: grid;">
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="1" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">1</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="2" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">2</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="3" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">3</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="4" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">4</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="5" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">5</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="6" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">6</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="7" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">7</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="8" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">8</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="9" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">9</button>
              <button type="button" class="btn btn-outline-danger" id="checkout-keypad-clear" style="font-size: 0.9rem; padding: 0.4rem; font-weight: 600;">Clear</button>
              <button type="button" class="btn btn-outline-secondary checkout-key" data-value="0" style="font-size: 1.2rem; padding: 0.4rem; font-weight: 600;">0</button>
              <button type="button" class="btn btn-outline-warning" id="checkout-keypad-back" style="font-size: 0.9rem; padding: 0.4rem; font-weight: 600;">‚Üê</button>
            </div>
          </div>
          
          <!-- Siblings section -->
          <div id="siblings-section" class="mb-2" style="display: none;">
            <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
              <div class="text-muted mb-1" style="font-size: 0.75rem; font-weight: 600;">Also check out:</div>
              <div id="siblings-list" style="max-height: 80px; overflow-y: auto;"></div>
            </div>
          </div>
          
          <div class="d-grid" style="gap: 0.35rem;">
            <button type="submit" class="btn" style="background: linear-gradient(135deg, {{ branding.accent_color }} 0%, {{ branding.primary_color }} 100%); color: white; border: none; border-radius: 10px; padding: 0.5rem; font-size: 1rem; font-weight: 600;">
              ‚úì Check Out
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal" style="border-radius: 10px; padding: 0.3rem; font-size: 0.85rem;">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function showQRCodeModal(qrCodeData, checkoutCode, shortUrl) {
    document.getElementById('qr-code-img').src = qrCodeData;
    document.getElementById('qr-code-text').textContent = checkoutCode || '';
    
    // Show short URL if available
    const shortUrlContainer = document.getElementById('short-url-container-kiosk');
    const shortUrlLink = document.getElementById('short-url-link-kiosk');
    if (shortUrl) {
        shortUrlLink.href = shortUrl;
        shortUrlLink.textContent = shortUrl;
        shortUrlContainer.style.display = 'block';
    } else {
        shortUrlContainer.style.display = 'none';
    }
    
    new bootstrap.Modal(document.getElementById('qrCodeModal')).show();
}

// Fullscreen buttons (both in navbar and fallback)
['fullscreen-btn', 'fullscreen-btn-nav'].forEach(function(btnId) {
    const btn = document.getElementById(btnId);
    if (btn) {
        btn.addEventListener('click', function() {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.webkitRequestFullscreen) { // Safari
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) { // IE11
                document.documentElement.msRequestFullscreen();
            }
        });
    }
});

// Auto-refresh every 60 seconds if modal not open
setInterval(function() {
    if (!document.querySelector('.modal.show')) {
        location.reload();
    }
}, 60000);
document.getElementById('checkin-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const phone = document.getElementById('phone').value;
    const eventId = document.getElementById('event-id').value;
    fetch('/checkin_last4', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: new URLSearchParams({last4: phone, event_id: eventId})
    })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                showFamilyModal(data);
            }
        });
});

// Keypad handling for touch screens
;(function() {
    const keypad = document.getElementById('keypad');
    if (!keypad) return;
    const phoneInput = document.getElementById('phone');
    const keys = keypad.querySelectorAll('.keypad-key');
    const back = document.getElementById('keypad-back');
    const clear = document.getElementById('keypad-clear');
    const pasteBtn = document.getElementById('paste-btn');

    function setPhone(v) {
        // enforce digits and max length 4
        v = String(v).replace(/\D/g, '').slice(0, 4);
        phoneInput.value = v;
        // Instant search when 4 digits
        if (v.length === 4) {
            setTimeout(() => document.getElementById('checkin-form').dispatchEvent(new Event('submit')), 100);
        }
    }


})();

function showFamilyModal(data) {
    const modalBody = document.getElementById('modal-body');
    // Build modal HTML from the data object (avoid Jinja/template literal mixing)
    let html = '';
    html += `<p style="font-size: 1.4rem; margin-bottom: 0.5rem;"><strong>Family:</strong> ${data.phone} - {{ branding.group_term }} ${data.troop}</p>`;
    html += `<p style="font-size: 0.9rem; color: #666; margin-bottom: 1.5rem;">{{ current_event_name }} - {{ current_event_date }}</p>`;
    html += `<form id="checkin-selected-form">`;
    html += `<input type="hidden" name="family_id" value="${data.family_id}">`;
    html += `<input type="hidden" name="event_id" value="{{ current_event_id }}">`;

    // Adult selector
    html += `<div class="mb-3 adult-selector">`;
    html += `<label class="form-label" for="adult-select">Select Adult Checking In:</label>`;
    html += `<select id="adult-select" name="adult_id" class="form-select" required>`;
    html += `<option value="">Choose adult...</option>`;
    (data.adults || []).forEach(function(adult, index) {
        // Select the default adult if specified, otherwise select the first one
        const isSelected = data.default_adult_id ? adult.id === data.default_adult_id : index === 0;
        html += `<option value="${adult.id}" ${isSelected ? 'selected' : ''}>${adult.name}</option>`;
    });
    html += `</select></div>`;

    // Kids checkboxes
    html += `<div class="mb-3 kid-section">`;
    html += `<label class="form-label">Select Kids to Check In:</label>`;
    html += `<div class="kid-options">`;
    (data.kids || []).forEach(function(kid) {
        const kidId = `kid-${kid.id}`;
        const isCheckedIn = kid.already_checked_in;
        const checkedInBadge = isCheckedIn ? ' <span class="badge bg-success" style="font-size: 0.75rem;">Already Checked In</span>' : '';
        const disabledAttr = isCheckedIn ? 'disabled checked' : '';
        const labelStyle = isCheckedIn ? 'style="opacity: 0.6;"' : '';
        html += `<label class="kid-option" for="${kidId}" ${labelStyle}>`;
        html += `<input class="form-check-input" type="checkbox" name="kid_ids" value="${kid.id}" id="${kidId}" ${disabledAttr}>`;
        html += `<span class="kid-name">${kid.name}${checkedInBadge}</span>`;
        html += `</label>`;
    });
    html += `</div>`;
    html += `</div>`;

    html += `<button type="submit" class="btn btn-lg w-100 modal-submit" style="background-color: {{ branding.accent_color }}; color: white; border: none;">Check In Selected</button>`;
    html += `</form>`;
    html += `<button type="button" class="btn btn-outline-danger position-absolute" data-bs-dismiss="modal" style="top: 0.5rem; right: 0.5rem; font-size: 1.5rem; width: 2.5rem; height: 2.5rem; padding: 0; line-height: 1; border-color: {{ branding.primary_color }}; color: {{ branding.primary_color }};" title="Wrong family">‚úï</button>`;

    modalBody.innerHTML = html;

    const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('familyModal'));
    modal.show();

    // Wire up the submit handler for the dynamically-created form
    const selForm = document.getElementById('checkin-selected-form');
    if (selForm) {
        selForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/checkin_selected', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(resp => {
                if (resp.success) {
                    modal.hide();
                    
                    // Show QR code if available
                    if (resp.qr_code) {
                        showQRCodeModal(resp.qr_code, resp.checkout_code, resp.short_url);
                    }
                    
                    // Print labels if any were returned (deferred to prevent UI blocking)
                    if (resp.labels && resp.labels.length > 0) {
                        resp.labels.forEach(label => {
                            setTimeout(() => {
                                printDymoLabel(
                                    label.kid_name,
                                    label.event_name,
                                    label.event_date,
                                    label.checkin_time,
                                    label.checkout_code,
                                    resp.label_size || '30336'
                                );
                            }, 0);
                        });
                    }
                    
                    // Add check-ins to the page dynamically first (for immediate feedback)
                    if (resp.checkins && resp.checkins.length > 0) {
                        const checkedInTbody = document.getElementById('checked-in-list');
                        const eventId = document.querySelector('[name="event_id"]').value;
                        
                        resp.checkins.forEach(checkin => {
                            const row = document.createElement('tr');
                            row.style.height = '2rem';
                            row.innerHTML = `
                                <td style="vertical-align: middle;">
                                    ${checkin.kid_name}
                                    ${checkin.kid_notes ? '<span class="text-muted ms-1" style="cursor: pointer; font-size: 0.65rem; opacity: 0.6;" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" title="' + checkin.kid_notes.replace(/\n/g, '<br>') + '">‚ÑπÔ∏è</span>' : ''}
                                    ${checkin.authorized_adults ? '<span class="text-muted ms-1" style="cursor: pointer; font-size: 0.65rem; opacity: 0.6;" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" title="<strong>Authorized for Checkout:</strong><br>' + checkin.authorized_adults.replace(/\n/g, '<br>') + '">üë§</span>' : ''}
                                </td>
                                <td style="vertical-align: middle;">${checkin.phone}</td>
                                <td style="vertical-align: middle;">${checkin.adult_name}</td>
                                <td style="vertical-align: middle; font-size: 0.8rem;">${checkin.formatted_time}</td>
                                <td style="vertical-align: middle;">
                                    <button class="btn btn-warning checkout-btn"
                                            data-kid-id="${checkin.kid_id}" 
                                            data-kid-name="${checkin.kid_name}"
                                            data-event-id="${eventId}">Check-Out</button>
                                </td>
                            `;
                            checkedInTbody.insertBefore(row, checkedInTbody.firstChild);
                            
                            // Initialize tooltips for this row
                            const tooltips = row.querySelectorAll('[data-bs-toggle="tooltip"]');
                            tooltips.forEach(el => new bootstrap.Tooltip(el));
                        });
                        
                        // Update count in header
                        const countBadge = document.querySelector('h2 .badge');
                        if (countBadge) {
                            const currentCount = parseInt(countBadge.textContent) || 0;
                            countBadge.textContent = currentCount + resp.checkins.length;
                        }
                    }
                    
                    // Show success message
                    if (resp.message) {
                        const alert = document.createElement('div');
                        alert.className = 'alert alert-success alert-dismissible fade show';
                        alert.innerHTML = `
                            ${resp.message}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        `;
                        document.querySelector('.container').insertBefore(alert, document.querySelector('.container').firstChild);
                        setTimeout(() => alert.remove(), 3000);
                    }
                } else {
                    alert('Error: ' + (resp.message || 'Unknown'));
                }
            })
            .catch(err => {
                console.error('checkin_selected error', err);
                alert('Network error while checking in');
            });
        });
    }
}

// Keypad handling for touch screens
document.addEventListener('DOMContentLoaded', function() {
    const keypad = document.getElementById('keypad');
    if (!keypad) {
        console.error('Keypad not found');
        return;
    }
    const phoneInput = document.getElementById('phone');
    if (!phoneInput) {
        console.error('Phone input not found');
        return;
    }
    const keys = keypad.querySelectorAll('.keypad-key');
    const back = document.getElementById('keypad-back');
    const clear = document.getElementById('keypad-clear');

    console.log('Keypad initialized with', keys.length, 'keys');

    function setPhone(v) {
        // enforce digits and max length 4
        v = String(v).replace(/\D/g, '').slice(0, 4);
        phoneInput.value = v;
        console.log('Phone value set to:', v);
        // Instant search when 4 digits
        if (v.length === 4) {
            setTimeout(() => {
                console.log('Auto-submitting form');
                document.getElementById('checkin-form').dispatchEvent(new Event('submit'));
            }, 100);
        }
    }

    keys.forEach(k => {
        k.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const val = this.dataset.value;
            console.log('Key clicked:', val);
            setPhone((phoneInput.value || '') + val);
            phoneInput.focus(); // Re-focus input after click
        });
    });

    if (back) {
        back.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            setPhone((phoneInput.value || '').slice(0, -1));
            phoneInput.focus(); // Re-focus input after click
        });
    }

    if (clear) {
        clear.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            setPhone('');
            phoneInput.focus(); // Re-focus input after click
        });
    }

    // instant search on input change (for keyboard typing)
    phoneInput.addEventListener('input', function() {
        if (this.value.length === 4) {
            setTimeout(() => document.getElementById('checkin-form').dispatchEvent(new Event('submit')), 100);
        }
    });

    // allow Enter on keyboard
    phoneInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            document.getElementById('search-btn').click();
        }
    });

    // quick tap feedback
    keypad.addEventListener('touchstart', function(e) {
        const btn = e.target.closest('button');
        if (btn) btn.classList.add('active');
    }, {passive: true});
    keypad.addEventListener('touchend', function(e) {
        const btn = e.target.closest('button');
        if (btn) btn.classList.remove('active');
    });

    // Auto-focus the phone input on page load
    phoneInput.focus();
});

// Handle checkout with code verification
let currentCheckoutData = null;

document.addEventListener('click', function(e) {
    if (e.target.classList.contains('checkout-btn')) {
        const kidId = e.target.dataset.kidId;
        const kidName = e.target.dataset.kidName;
        const eventId = e.target.dataset.eventId;
        
        // Store data for later use
        currentCheckoutData = { kidId, kidName, eventId, siblings: [] };
        
        // First, fetch siblings
        const siblingFormData = new FormData();
        siblingFormData.append('event_id', eventId);
        
        fetch(`/get_siblings/${kidId}`, {
            method: 'POST',
            body: siblingFormData
        })
        .then(response => response.json())
        .then(siblingsData => {
            currentCheckoutData.siblings = (siblingsData.success && siblingsData.siblings) ? siblingsData.siblings : [];
            
            // If there are siblings, always show the modal to allow selection
            if (currentCheckoutData.siblings.length > 0) {
                // Show modal with siblings for checkout
                document.getElementById('checkout-kid-name').textContent = kidName;
                document.getElementById('checkout-code-input').value = '';
                
                // Show siblings section
                const siblingsList = document.getElementById('siblings-list');
                siblingsList.innerHTML = '';
                currentCheckoutData.siblings.forEach(sibling => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'form-check';
                    checkboxDiv.innerHTML = `
                        <input class="form-check-input sibling-checkbox" type="checkbox" value="${sibling.kid_id}" id="sibling-${sibling.kid_id}" checked>
                        <label class="form-check-label" for="sibling-${sibling.kid_id}" style="font-size: 0.9rem;">
                            ${sibling.name}
                        </label>
                    `;
                    siblingsList.appendChild(checkboxDiv);
                });
                document.getElementById('siblings-section').style.display = 'block';
                
                const modal = new bootstrap.Modal(document.getElementById('checkoutCodeModal'));
                modal.show();
                document.getElementById('checkoutCodeModal').addEventListener('shown.bs.modal', function() {
                    document.getElementById('checkout-code-input').focus();
                }, { once: true });
            } else {
                // No siblings, proceed with normal checkout flow
                const formData = new FormData();
                formData.append('event_id', eventId);
                
                fetch(`/checkout/${kidId}`, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else if (data.code_required) {
                        // Show modal for checkout code
                        document.getElementById('checkout-kid-name').textContent = kidName;
                        document.getElementById('checkout-code-input').value = '';
                        document.getElementById('siblings-section').style.display = 'none';
                        
                        const modal = new bootstrap.Modal(document.getElementById('checkoutCodeModal'));
                        modal.show();
                        document.getElementById('checkoutCodeModal').addEventListener('shown.bs.modal', function() {
                            document.getElementById('checkout-code-input').focus();
                        }, { once: true });
                    } else {
                        alert(data.message || 'Checkout failed');
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        })
        .catch(error => {
            console.error('Error fetching siblings:', error);
            // On error, proceed without siblings
            const formData = new FormData();
            formData.append('event_id', eventId);
            
            fetch(`/checkout/${kidId}`, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else if (data.code_required) {
                    document.getElementById('checkout-kid-name').textContent = kidName;
                    document.getElementById('checkout-code-input').value = '';
                    document.getElementById('siblings-section').style.display = 'none';
                    const modal = new bootstrap.Modal(document.getElementById('checkoutCodeModal'));
                    modal.show();
                    document.getElementById('checkoutCodeModal').addEventListener('shown.bs.modal', function() {
                        document.getElementById('checkout-code-input').focus();
                    }, { once: true });
                } else {
                    alert(data.message || 'Checkout failed');
                }
            })
            .catch(error => console.error('Error:', error));
        });
    }
});

// Checkout code keypad handlers
document.addEventListener('DOMContentLoaded', function() {
    const checkoutInput = document.getElementById('checkout-code-input');
    const checkoutKeys = document.querySelectorAll('.checkout-key');
    const checkoutBack = document.getElementById('checkout-keypad-back');
    const checkoutClear = document.getElementById('checkout-keypad-clear');
    
    checkoutKeys.forEach(key => {
        key.addEventListener('click', function() {
            const value = this.dataset.value;
            if (checkoutInput.value.length < 10) {
                checkoutInput.value += value;
            }
        });
    });
    
    if (checkoutBack) {
        checkoutBack.addEventListener('click', function() {
            checkoutInput.value = checkoutInput.value.slice(0, -1);
        });
    }
    
    if (checkoutClear) {
        checkoutClear.addEventListener('click', function() {
            checkoutInput.value = '';
        });
    }
});

// Handle checkout code form submission
document.getElementById('checkout-code-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (!currentCheckoutData) return;
    
    const code = document.getElementById('checkout-code-input').value.trim();
    
    const codeFormData = new FormData();
    codeFormData.append('event_id', currentCheckoutData.eventId);
    if (code) {
        codeFormData.append('checkout_code', code);
    }
    
    // Add selected siblings if any
    const selectedSiblings = document.querySelectorAll('.sibling-checkbox:checked');
    selectedSiblings.forEach(checkbox => {
        codeFormData.append('additional_kid_ids', checkbox.value);
    });
    
    fetch(`/checkout/${currentCheckoutData.kidId}`, {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: codeFormData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            bootstrap.Modal.getInstance(document.getElementById('checkoutCodeModal')).hide();
            location.reload();
        } else if (data.code_required) {
            // Code is required but wasn't provided or was invalid
            const input = document.getElementById('checkout-code-input');
            input.classList.add('is-invalid');
            input.value = '';
            input.placeholder = data.message || 'Code required - please enter';
            input.focus();
            setTimeout(() => {
                input.classList.remove('is-invalid');
                input.placeholder = 'Code';
            }, 2000);
        } else {
            // Other error
            const input = document.getElementById('checkout-code-input');
            input.classList.add('is-invalid');
            input.value = '';
            input.placeholder = data.message || 'Checkout failed';
            setTimeout(() => {
                input.classList.remove('is-invalid');
                input.placeholder = 'Code';
            }, 2000);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Network error during checkout');
    });
});

// Enable Bootstrap tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>

<style>
/* Prevent text selection on touch */
* {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Re-enable text selection for form inputs */
input, select, textarea {
    -webkit-user-select: text;
    -khtml-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
}

body {
    background-color: var(--bg-color);
    font-size: 0.9rem;
    touch-action: manipulation;
    margin: 0;
    padding: 0;
}

.container-fluid {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0.5rem;
}

.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    margin-bottom: 0.5rem;
}

.card-body {
    padding: 1rem;
}

.form-control {
    border-radius: 0.25rem;
    border: 2px solid #ced4da;
}

.form-control:focus {
    border-color: {{ branding.primary_color }};
    box-shadow: 0 0 0 0.2rem rgba(121, 6, 13, 0.25);
}

.btn {
    border-radius: 0.25rem;
    border: none;
    font-weight: 600;
    transition: all 0.2s ease;
}

.btn:hover, .btn:focus {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}

.btn:hover {
    filter: brightness(0.9);
}

.btn:active {
    transform: translateY(0);
}

.table th, .table td {
    padding: 0.5rem;
    vertical-align: middle;
}

.modal-content {
    border-radius: 0.5rem;
    border: none;
}

#familyModal .modal-dialog {
    max-width: 900px;
    width: calc(100% - 2rem);
    margin: 1.5rem auto;
}

#familyModal .modal-header {
    padding: 1rem 1.25rem;
}

#familyModal .modal-title {
    font-size: 1.6rem;
}

#familyModal .modal-body {
    padding: 1rem 1.25rem;
    max-height: 65vh;
    overflow-y: auto;
}

#familyModal .form-label {
    font-size: 1.1rem;
    margin-bottom: 0.4rem;
}

#familyModal .adult-selector select {
    font-size: 1.1rem;
    padding: 0.6rem;
}

.kid-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 0.75rem;
}

.kid-option {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    padding: 0.6rem 0.75rem;
    border: 1px solid var(--card-border);
    border-radius: 0.5rem;
    background-color: var(--card-bg);
}

.kid-option .form-check-input {
    width: 1.2rem;
    height: 1.2rem;
    margin: 0;
}

.kid-name {
    font-size: 1.1rem;
}

.modal-submit {
    font-size: 1.3rem;
    padding: 0.85rem;
    margin-top: 0.75rem;
}

.modal-header {
    border-bottom: 1px solid #dee2e6;
}

.modal-body {
    max-height: 60vh;
    overflow-y: auto;
}

.form-check {
    background-color: var(--card-bg);
    transition: background-color 0.2s ease;
}

.form-check:hover {
    background-color: var(--card-border);
}

.form-check-input:checked {
    background-color: {{ branding.accent_color }};
    border-color: {{ branding.accent_color }};
}

/* Trail Life USA brand colors */
#search-btn:hover {
    background-color: #5a0408 !important;
}

.modal-submit:hover {
    background-color: #3a4620 !important;
}

/* Touch device optimizations */
@media (pointer: coarse) {
    .form-check-input {
        transform: scale(1.2);
        margin-right: 0.75rem;
    }

    .btn-close {
        width: 2rem;
        height: 2rem;
    }

    .table {
        font-size: 1rem;
    }
}

/* Laptop screens - adjustments */
@media (max-width: 1366px) {
    body {
        font-size: 0.8rem;
    }

    .container-fluid {
        padding: 0.25rem;
    }

    .card-body {
        padding: 0.75rem;
    }
}

/* Extra large touch screens */
@media (min-width: 1200px) and (pointer: coarse) {
    .form-control {
        font-size: 1.8rem;
        padding: 1rem;
    }

    .btn {
        font-size: 1.8rem;
        padding: 1rem 1.5rem;
    }

    .form-check-input {
        width: 2rem;
        height: 2rem;
    }

    .form-check-label {
        font-size: 1.4rem;
    }
}
</style>
<script src="/static/dymo_print.js"></script>
{% endblock %}